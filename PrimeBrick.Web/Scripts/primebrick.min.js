"use strict";var App=function(){};App.Utils={isNullOrUndefined:function(n){return typeof n=="undefined"||n==null?!0:!1},isNullOrEmpty:function(n){return typeof n=="string"&&n.length>=1?!1:!0}};App.Enumerators={AuthenticationTypes:{Token:0,Windows:1}};App.Settings={View:{AutoLoadLabels:!0},API:{AuthenticationType:App.Enumerators.AuthenticationTypes.Token}};App.Security={GetAuthenticationToken:function(){var n=App.Session.Load("userAuthToken");return n&&n.access_token&&n.token_type||console.error("Cannot call secure api without authorization token. Please, login before do anything!"),n}};App.API={CallSecureApi:function(n,t,i,r,u){if(App.Utils.isNullOrEmpty(n))return App.Log.Error("Cannot call API because the parameter [path] is not valued. It is mandatory!",!0),!1;typeof t!="function"&&App.Log.Warning("No callback function has been specified for API at path ["+n+"].");var f=null;return App.Utils.isNullOrUndefined(u)&&(u={}),$.ajax({url:n,type:App.Utils.isNullOrUndefined(u.method)?"GET":u.method.toUpperCase(),dataType:"json",async:App.Utils.isNullOrUndefined(u.async)?!0:u.async,data:r,headers:App.Settings.API.AuthenticationType==App.Enumerators.AuthenticationTypes.Token?{Authorization:userAuthToken.token_type+" "+userAuthToken.access_token}:"",success:function(n){typeof t=="function"&&t(n,!1,i);f=n},error:function(n){App.Log.Error("Error: While calling API; "+n.responseText);typeof t=="function"&&t(n.responseJSON?n.responseJSON:n.responseText,!0,i);f=null}}),f}};App.Controller={currentInstance:null,Load:function(n,t){require(["app/"+n],function(i){if(App.Log.Info("The controller ['app/"+n+"'] has been loaded!"),i.routes==null||i.routes.length<=0){App.Log.Error("The controller doesn't have a routes array defined!",!0);return}$.each(i.routes,function(n,t){if(App.Utils.isNullOrUndefined(t.path))return App.Log.Error("The controller route at index ["+n+"] doesn't have the property [path] valued. It is mandatory!"),!1;if(typeof t.on!="function"){if(App.Utils.isNullOrUndefined(t.config))return App.Log.Error("The controller route at index ["+n+"] doesn't have the property [config] valued. It is mandatory!",!0),!1;if(App.Utils.isNullOrUndefined(t.config.namespace))return App.Log.Error("The controller route at index ["+n+"] doesn't have the property [config.namespace] valued. It is mandatory to load a view!",!0),!1;if(App.Utils.isNullOrUndefined(t.config.view))return App.Log.Error("The controller route at index ["+n+"] doesn't have the property [config.view] valued. It is mandatory to load a view!",!0),!1;if(App.Utils.isNullOrUndefined(t.config.viewContainer))return App.Log.Error("The controller route at index ["+n+"] doesn't have the property [config.viewContainer] valued. It is mandatory to load a view!",!0),!1;t.on=function(){var i=typeof t["onLoad"+t.config.view]=="function"?t["onLoad"+t.config.view]:null;i||App.Log.Warning("No loading function [onLoad"+t.config.view+"] has been specified for controller route at index ["+n+"].");App.View.Load(t,i)}}Router.add(t)});var r=Router.matchRoute(window.location.hash);r&&Router.run(r);App.Controller.currentInstance=i;t&&t()},function(n){App.Log.Error(n)})}};App.View={Load:function(n,t){var r,i;if(App.Utils.isNullOrUndefined(n.config))return App.Log.Error("Cannot load a view because the parameter [config] is not valued. It is mandatory!",!0),!1;if(App.Utils.isNullOrUndefined(n.config.namespace))return App.Log.Error("The view configuration doesn't have the property [config.namespace] valued. It is mandatory to load a view!",!0),!1;if(App.Utils.isNullOrUndefined(n.config.view))return App.Log.Error("The view configuration doesn't have the property [config.view] valued. It is mandatory to load a view!",!0),!1;if(App.Utils.isNullOrUndefined(n.config.viewContainer))return App.Log.Error("The view configuration doesn't have the property [config.viewContainer] valued. It is mandatory to load a view!",!0),!1;r=App.View.__GetViewPath(n);r.viewPath||App.Log.Error("Cannot recreate the view path from configuration or url parameters!");i=null;require(["text!"+r.viewPath],function(u){try{if(App.Controller.currentInstance.view&&(App.Controller.currentInstance.view.teardown(),App.Controller.currentInstance.view=null),i=new Ractive({el:"#"+n.config.viewContainer,template:u}),!App.Utils.isNullOrUndefined(n.config.viewEvents))i.on(n.config.viewEvents);if(App.Utils.isNullOrUndefined(n.config.viewPartials)||$.each(n.config.viewPartials,function(t,r){i.partials[r]="";require(["text!"+n.config.namespace.replace(/\./g,"/")+"/"+r+".html"],function(t){i.resetPartial(r,t);var u=typeof n["onLoad"+r]=="function"?"onLoad"+r:null;u||App.Log.Warning("No loading function [onLoad"+r+"] has been specified for partial ["+r+"].");n[u]()})}),!App.Utils.isNullOrUndefined(n.config.modelObservers))for(var f in n.config.modelObservers)n.config.modelObservers.hasOwnProperty(f)&&i.observe(f,n.config.modelObservers[f],{init:!1});App.Controller.currentInstance.view=i;App.Controller.currentInstance.view.path=r.viewPath;window.system.view.set("pageSubTitle","");window.system.view.set("pageTitle","???");window.system.view.set("pageIcon","glyphicon glyphicon-new-window");window.system.view.set("pageRootTitle","???");window.system.view.set("pageRootPath","#/"+n.config.namespace.replace("app.",""));App.Settings.View.AutoLoadLabels?App.View.LoadLabels(i,function(){var e=i.get("view.labels.pageTitle"),u,f;e!=null&&window.system.view.set("pageTitle",e);u=i.get("view.labels.pageSubTitle");u!=null&&window.system.view.set("pageSubTitle",u);f=i.get("view.labels.pageIcon");f!=null&&window.system.view.set("pageIcon",f);App.Log.Info("The view ["+r.viewName+"] in ["+n.config.namespace+"] is ready!");t&&t.bind(n,i)()}):t&&t.bind(n,i)();App.Log.Info("The view ["+r.viewName+"] in ["+n.config.namespace+"] has been loaded!")}catch(e){App.Log.Error("Error: Impossible to load the view. "+e.message,!0)}},function(n){App.Log.Error(n,!0)})},__GetViewPath:function(n){if(App.Utils.isNullOrUndefined(n))return App.Log.Error("The route configuration is not an object!"),null;if(App.Utils.isNullOrUndefined(n.config))return App.Log.Error("The route configuration do not contain a valid [config] property!"),null;if(App.Utils.isNullOrUndefined(n.config.namespace))return App.Log.Error("The route configuration do not contain a valid [config.namespace] property!"),null;if(App.Utils.isNullOrUndefined(n.config.view)&&App.Utils.isNullOrUndefined(n.params)&&App.Utils.isNullOrUndefined(n.params.viewName))return App.Log.Error("The route configuration do not contain a valid [config.view] or [params.viewName] property!"),null;var t={viewName:null,viewPath:null};if(n.config.view)t.viewName=n.config.view;else if(n.params.viewName)t.viewName=n.params.viewName;else return console.error("Cannot find the view name for the path "+n.url+"!"),t;return t.viewPath=n.config.namespace.replace(/\./g,"/")+"/"+t.viewName+".html",t},LoadLabels:function(n,t){if(!n.name){App.Log.Error("Cannot find view name!",!0);return}$.ajax({url:"/api/dictionary/viewlabels/"+encodeURI(n.name)+"/",type:"GET",async:!0,dataType:"json",success:function(i){n.set("view.labels",i);t&&t(i)},error:function(n,t,i){n.responseText!=null&&n.responseText.length<=100?App.Log.Error("Impossible to get the view labels.\r\nError: "+n.responseText,!0):(App.Log.Error("Impossible to get the view labels.\r\nError: "+n.responseText,!1),App.Log.Error("Impossible to get the view labels.\r\nError: "+i,!0))}})}};App.Log={Info:function(n,t){console.info(n);t===!0&&alert(n)},Warning:function(n,t){console.warn(n);t===!0&&alert(n)},Error:function(n,t){console.error(n);t===!0&&alert(n)}};App.UI={RenderWrapper:function(){var n=$("#application-menu").height(),t,i;$("body").css("padding-top",n+"px");t=$(window).height();i=$("#wrapper");i.height(t-n)}};
//# sourceMappingURL=primebrick.min.js.map